<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Home</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body class="bg-dark">
    <h1 class="text-center text-light mt-3 display-1">NETWORK SCANNER</h1>
    
    <div id="scanTable" class="container mt-5 ms-5 float-start text-warning border-info border-bottom" style="width: 45%; height: 35%; overflow-y: scroll; border-radius: 20px;">
        <div class="row text-dark p-2 text-center bg-info" style="font-size: 20px;">
            <p class="col-1"><b>PortId</b></p>
            <p class="col">ip_start</p>
            <p class="col">ip_end</p>
            <p class="col-2">enabled</p>
            <p class="col-2">finished</p>
        </div>
    </div>
    
    <div id="portTable" class="container mt-5 me-5 float-end text-warning border-info border-bottom" style="width: 45%; height: 35%; overflow-y: scroll; border-radius: 20px;">
        <div class="row text-dark p-2 text-center bg-info" style="font-size: 20px;">
            <p class="col-1"><b>ScanId</b></p>
            <p class="col">port</p>
            <p class="col-2">enabled</p>
            <p class="col-4">port_description</p>
        </div>
    </div>

    <center>
        <button id="scanBtn" class="btn btn-lg btn-outline-light mx-auto mt-5">Start Scan</button>
    </center>

    <div id="resultTable" class="container mb-2 fixed-bottom text-info border-light border-bottom" style="height: 35%; overflow-y: scroll; border-radius: 20px;">
        <div class="row text-dark p-2 text-center bg-light" style="font-size: 20px;">
            <p class="col-1"><b>ResultId</b></p>
            <p class="col-1">scanId</p>
            <p class="col">ip</p>
            <p class="col">status</p>
            <p class="col">banner</p>
        </div>
    </div>

</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
var getPorts = function(){
    $.get("./ports", function(data, status){
        var portRowIdStr = document.getElementById('portTable').lastChild.id;
        if(portRowIdStr != null){
            rowsNo = Number(portRowIdStr.substring(7)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('portTable').removeChild(document.getElementById('portRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var port = document.createElement('p');
                    port.className = 'col';
                    port.innerHTML = data[a].port;
                var enabled = document.createElement('p');
                    enabled.className = 'col-2';
                    enabled.innerHTML = data[a].enabled;
                var port_description = document.createElement('p');
                    port_description.className = 'col-4';
                    port_description.innerHTML = data[a].port_description;
                
                var row = document.createElement('div');
                    row.id = 'portRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(port);
                    row.append(enabled);
                    row.append(port_description);
                
                document.getElementById('portTable').append(row);
            }
        }
    });
}

var getResults = function(){
    $.get("./results", function(data, status){
        var resultRowIdStr = document.getElementById('resultTable').lastChild.id;
        if(resultRowIdStr != null){
            rowsNo = Number(resultRowIdStr.substring(9)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('resultTable').removeChild(document.getElementById('resultRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var scanId = document.createElement('p');
                    scanId.className = 'col-1';
                    scanId.innerHTML = data[a].scanId;
                var ip = document.createElement('a');
                    ip.className = 'col';
                    ip.innerHTML = data[a].ip+":"+data[a].port;
                    ip.setAttribute('href', "http://"+data[a].ip+":"+data[a].port);
                var status = document.createElement('p');
                    status.className = 'col';
                    status.innerHTML = data[a].status;
                var banner = document.createElement('p');
                    banner.className = 'col';
                    banner.innerHTML = data[a].banner;
                
                var row = document.createElement('div');
                    row.id = 'resultRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(scanId);
                    row.append(ip);
                    row.append(status);
                    row.append(banner);
                
                document.getElementById('resultTable').append(row);
            }
        }
    });
}

var getScans = function(){
    $.get("./scans", function(data, status){

        var scanRowIdStr = document.getElementById('scanTable').lastChild.id;
        if(scanRowIdStr != null){
            rowsNo = Number(scanRowIdStr.substring(7)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('scanTable').removeChild(document.getElementById('scanRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var ip_start = document.createElement('a');
                    ip_start.className = 'col';
                    ip_start.innerHTML = data[a].ip_start;
                    ip_start.setAttribute('href', "http://"+data[a].ip_start);
                var ip_end = document.createElement('a');
                    ip_end.className = 'col';
                    ip_end.innerHTML = data[a].ip_end;
                    ip_end.setAttribute('href', "http://"+data[a].ip_end);
                var enabled = document.createElement('p');
                    enabled.className = 'col-2';
                    enabled.innerHTML = data[a].enabled;
                var finished = document.createElement('p');
                    finished.className = 'col-2';
                    finished.innerHTML = data[a].finished;
                
                var row = document.createElement('div');
                    row.id = 'scanRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(ip_start);
                    row.append(ip_end);
                    row.append(enabled);
                    row.append(finished);
                
                document.getElementById('scanTable').append(row);
            }
        }
    });
}

$(document).ready(function(){
    getPorts();
    getResults();
    getScans();
    
    setInterval(getPorts, 1000);
    setInterval(getResults, 1000);
    setInterval(getScans, 1000);    
});

$("#scanBtn").click(function(){
    console.log('in btn click now')

    $.get("./scanStart", function(data, status){
        console.log('backed')
    })
});

</script>
</html>