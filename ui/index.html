<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Home</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">   
</head>
<body class="bg-dark">
    <h1 class="text-center text-light mt-3 display-1">NETWORK SCANNER</h1>
    
    <div id="scanTable" class="container mt-5 ms-5 float-start text-warning border-info border-bottom" style="width: 50%; height: 35%; overflow-y: scroll; border-radius: 20px;">
        <div class="row text-dark p-2 text-center bg-info" style="font-size: 20px;">
            <p class="col-1"><b>ScanId</b></p>
            <p class="col">ip_start</p>
            <p class="col">ip_end</p>
            <p class="col-2">enabled</p>
            <p class="col-2">finished</p>
            <p class="col-2">scan_status</p>
        </div>
        <div class="row text-dark p-2 text-center bg-secondary" style="font-size: 15px; height: 40px;">
            <div class="col-1"></div>
            <input type="text" id="newScanIpStart" class="col text-center ms-2">
            <input type="text" id="newScanIpEnd" class="col ms-2">
            <input type="checkbox" id="newScanEnabled" class="col-2 text-center" style="height: 20px;">
            <input type="checkbox" id="newScanFinished" class="col-2 text-center" style="height: 20px;">
            <button id="saveNewScan" class="col-2">&#10004;</button>
        </div>
    </div>

    <div id="portTable" class="container mt-5 me-5 float-end text-warning border-info border-bottom" style="width: 40%; height: 35%; overflow-y: scroll; border-radius: 20px;">
        <div class="row text-dark p-2 text-center bg-info" style="font-size: 20px;">
            <p class="col-1"><b>PortId</b></p>
            <p class="col-2">port</p>
            <p class="col-2">enabled</p>
            <p class="col">port_description</p>
            <p class="col-2">port_status</p>
        </div>
        <div class="row text-dark p-2 text-center bg-secondary" style="font-size: 15px; height: 40px;">
            <div class="col-1"></div>
            <input type="text" id="newPortPort" class="col-2 text-center">
            <input type="checkbox" id="newPortEnabled" class="col-2" style="height: 20px;">
            <input type="text" id="newPortPortDesc" class="col text-center me-3">
            <button id="saveNewPort" class="col-2">&#10004;</button>
        </div>
    </div>

    <center>
        <button id="scanBtn" class="btn btn-lg btn-outline-light mx-auto mt-5" style="border-radius: 15px; width: 200px;">Start Scan</button>
    </center>

    <div id="resultTable" class="container mb-2 fixed-bottom text-info border-light border-bottom" style="height: 35%; overflow-y: scroll; border-radius: 20px;">
        <div class="row text-dark p-2 text-center bg-light" style="font-size: 20px;">
            <p class="col-1"><b>ResultId</b></p>
            <p class="col-1">scanId</p>
            <p class="col">ip</p>
            <p class="col">status</p>
            <p class="col">banner</p>
        </div>
    </div>

</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
var getPorts = function(){
    $.get("./ports", function(data, status){
        var portRowIdStr = document.getElementById('portTable').lastChild.id;
        if(portRowIdStr != null){
            rowsNo = Number(portRowIdStr.substring(7)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('portTable').removeChild(document.getElementById('portRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var portId = document.createElement('p');
                    portId.id = 'portId'+a;
                    portId.className = 'col-1';
                    portId.innerHTML = data[a].id;
                var port = document.createElement('p');
                    port.id = 'port'+a;
                    port.className = 'col-2';
                    port.innerHTML = data[a].port;
                var enabled = document.createElement('input');
                    enabled.type = 'checkbox';
                    enabled.id = 'portEnabled'+a;
                    enabled.className = 'col-2';
                    enabled.checked = data[a].enabled;
                    enabled.style.height = '20px';
                var port_description = document.createElement('p');
                    port_description.id = 'port_description'+a;
                    port_description.className = 'col';
                    port_description.innerHTML = data[a].port_description;
                var updatePort = document.createElement('button');
                    updatePort.id = 'updatePort'+a
                    updatePort.className = 'col-2 btn btn-outline-info fa text-light';
                    updatePort.innerHTML = '&#xf087;';
                    updatePort.onmouseover = function(){
                        this.style.cursor = 'pointer'; 
                    };
                    updatePort.onclick = function(){
                        var idNo = (this.id.substring(8));
                        
                    }
                
                var row = document.createElement('div');
                    row.id = 'portRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(portId);
                    row.append(port);
                    row.append(enabled);
                    row.append(port_description);
                    row.append(updatePort);
                
                document.getElementById('portTable').append(row);
            }
        }
    });
}

var getResults = function(){
    $.get("./results", function(data, status){
        var resultRowIdStr = document.getElementById('resultTable').lastChild.id;
        if(resultRowIdStr != null){
            rowsNo = Number(resultRowIdStr.substring(9)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('resultTable').removeChild(document.getElementById('resultRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var scanId = document.createElement('p');
                    scanId.className = 'col-1';
                    scanId.innerHTML = data[a].scanId;
                var ip = document.createElement('a');
                    ip.className = 'col';
                    ip.innerHTML = data[a].ip+":"+data[a].port;
                    ip.setAttribute('href', "http://"+data[a].ip+":"+data[a].port);
                var status = document.createElement('p');
                    status.className = 'col';
                    status.innerHTML = data[a].status;
                var banner = document.createElement('p');
                    banner.className = 'col';
                    banner.innerHTML = data[a].banner;
                
                var row = document.createElement('div');
                    row.id = 'resultRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(scanId);
                    row.append(ip);
                    row.append(status);
                    row.append(banner);
                
                document.getElementById('resultTable').append(row);
            }
        }
    });
}

var getScans = function(){
    $.get("./scans", function(data, status){

        var scanRowIdStr = document.getElementById('scanTable').lastChild.id;
        if(scanRowIdStr != null){
            rowsNo = Number(scanRowIdStr.substring(7)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('scanTable').removeChild(document.getElementById('scanRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var scanId = document.createElement('p');
                    scanId.id = 'scanId'+a;
                    scanId.className = 'col-1';
                    scanId.innerHTML = data[a].id;
                var ip_start = document.createElement('a');
                    ip_start.id = 'ip_start'+a;
                    ip_start.className = 'col';
                    ip_start.innerHTML = data[a].ip_start;
                    ip_start.setAttribute('href', "http://"+data[a].ip_start);
                var ip_end = document.createElement('a');
                    ip_end.id = 'ip_end'+a;
                    ip_end.className = 'col';
                    ip_end.innerHTML = data[a].ip_end;
                    ip_end.setAttribute('href', "http://"+data[a].ip_end);
                var enabled = document.createElement('input');
                    enabled.id = 'ScanEnabled'+a;
                    enabled.type = 'checkbox';
                    enabled.id = 'enabled'+a;
                    enabled.className = 'col-2';
                    enabled.checked = data[a].enabled;
                    enabled.style.height = '20px';
                var finished = document.createElement('input');
                    finished.id = 'finished'+a;
                    finished.type = 'checkbox';
                    finished.id = 'enabled'+a;
                    finished.className = 'col-2';
                    finished.innerHTML = data[a].finished;
                    finished.style.height = '20px';
                var updateScan = document.createElement('button');
                    updateScan.id = 'updateScan'+a
                    updateScan.className = 'col-2 btn btn-outline-info fa text-light';
                    updateScan.innerHTML = '&#xf087;';
                    updateScan.onmouseover = function(){
                        this.style.cursor = 'pointer'; 
                    };
                    updateScan.onclick = function(){
                        var idNo = (this.id.substring(8));
                        
                    }
                
                var row = document.createElement('div');
                    row.id = 'scanRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(scanId);
                    row.append(ip_start);
                    row.append(ip_end);
                    row.append(enabled);
                    row.append(finished);
                    row.append(updateScan);
                
                document.getElementById('scanTable').append(row);
            }
        }
    });
}



$(document).ready(function(){
    getPorts();
    getResults();
    getScans();
    
    setInterval(getPorts, 5000);
    setInterval(getResults, 5000);
    setInterval(getScans, 5000);    
});

$("#scanBtn").click(function(){
    $.get("./scanStart", function(data, status){
        
    })
});

$("#saveNewPort").click(function(){
    $.post("./ports", {
        port: document.getElementById('newPortPort').value,
        port_description: document.getElementById('newPortPortDesc').value,
    }, function(data, status){
        
    })
})

$("#saveNewScan").click(function(){
    $.post("./scans", {
        ip_start: document.getElementById('newScanIpStart').value,
        ip_end: document.getElementById('newScanIpEnd').value,
        enabled: document.getElementById('newScanEnabled').value,
    }, function(data, status){
        
    })
})
</script>
</html>