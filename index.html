<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Home</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <h1 class="text-center display-1 mt-3">NETWORK<button class="btn btn-lg btn-success mx-3">Scan Now</button>SCANNER</h1>

    <div id="scanTable" class="container mt-5 ms-5 float-start border rounded" style="width: 45%; height: 35%; overflow-y: scroll;">
        <div class="row bg-dark text-light p-2 text-center">
            <p class="col-1">id</p>
            <a href="#" class="col text-info">ip_start</a>
            <a href="#" class="col text-info">ip_end</a>
            <p class="col-2">enabled</p>
            <p class="col-2">finished</p>
        </div>
    </div>
    
    <div id="portTable" class="container mt-5 me-5 float-end border rounded" style="width: 45%; height: 35%; overflow-y: scroll;">
        <div class="row bg-dark text-light p-2 text-center">
            <p class="col-1">id</p>
            <p class="col">port</p>
            <p class="col-2">enabled</p>
            <p class="col-4">port_description</p>
        </div>
    </div>
    
    <div id="resultTable" class="container mb-5 fixed-bottom border rounded" style="height: 35%; overflow-y: scroll;">
        <div class="row bg-dark text-light p-2 text-center">
            <p class="col-1">id</p>
            <p class="col-1">scanId</p>
            <a href="#" class="col text-info">ip</a>
            <p class="col">status</p>
            <p class="col">banner</p>
        </div>
    </div>

</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
var ajax_f = function(){
    $.get("./ports", function(data, status){
        var portRowIdStr = document.getElementById('portTable').lastChild.id;
        if(portRowIdStr != null){
            rowsNo = Number(portRowIdStr.slice(-1)) + 1;
            for(a=0;a<rowsNo;a++){
                document.getElementById('portTable').removeChild(document.getElementById('portRow'+a));
            }
        } 

        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var port = document.createElement('p');
                    port.className = 'col';
                    port.innerHTML = data[a].port;
                var enabled = document.createElement('p');
                    enabled.className = 'col-2';
                    enabled.innerHTML = data[a].enabled;
                var port_description = document.createElement('p');
                    port_description.className = 'col-4';
                    port_description.innerHTML = data[a].port_description;
                
                var row = document.createElement('div');
                    row.id = 'portRow'+a
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(port);
                    row.append(enabled);
                    row.append(port_description);
                
                document.getElementById('portTable').append(row);
            }
        }
    });
}

$(document).ready(function(){
    $.get("./results", function(data, status){
        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var scanId = document.createElement('p');
                    scanId.className = 'col-1';
                    scanId.innerHTML = data[a].scanId;
                var ip = document.createElement('a');
                    ip.className = 'col';
                    ip.innerHTML = data[a].ip+":"+data[a].port;
                    ip.setAttribute('href', "http://"+data[a].ip+":"+data[a].port);
                var status = document.createElement('p');
                    status.className = 'col';
                    status.innerHTML = data[a].status;
                var banner = document.createElement('p');
                    banner.className = 'col';
                    banner.innerHTML = data[a].banner;
                
                var row = document.createElement('div');
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(scanId);
                    row.append(ip);
                    row.append(status);
                    row.append(banner);
                
                document.getElementById('resultTable').append(row);
            }
        }
    });
    
    $.get("./scans", function(data, status){
        if(status == 'success'){
            for(a=0;a<data.length;a++){
                var id = document.createElement('p');
                    id.className = 'col-1';
                    id.innerHTML = data[a].id;
                var ip_start = document.createElement('a');
                    ip_start.className = 'col';
                    ip_start.innerHTML = data[a].ip_start;
                    ip_start.setAttribute('href', "http://"+data[a].ip_start);
                var ip_end = document.createElement('a');
                    ip_end.className = 'col';
                    ip_end.innerHTML = data[a].ip_end;
                    ip_end.setAttribute('href', "http://"+data[a].ip_end);
                var enabled = document.createElement('p');
                    enabled.className = 'col-2';
                    enabled.innerHTML = data[a].enabled;
                var finished = document.createElement('p');
                    finished.className = 'col-2';
                    finished.innerHTML = data[a].finished;
                
                var row = document.createElement('div');
                    row.className = 'row p-2 text-center';
                    row.append(id);
                    row.append(ip_start);
                    row.append(ip_end);
                    row.append(enabled);
                    row.append(finished);
                
                document.getElementById('scanTable').append(row);
            }
        }
    });
    
    setInterval(ajax_f, 100);

    
});
</script>
</html>